var multi=function(){var e=function(e,t,a){var n=e.options[t.target.getAttribute("multi-index")];if(!n.disabled){n.selected=!n.selected;var i,l,d=a.limit;if(d>-1){for(var r=0,s=0;s<e.options.length;s++)e.options[s].selected&&r++;if(r===d)for(this.disabled_limit=!0,"function"==typeof a.limit_reached&&a.limit_reached(),s=0;s<e.options.length;s++)(o=e.options[s]).selected||o.setAttribute("disabled",!0);else if(this.disabled_limit){for(s=0;s<e.options.length;s++){var o;"false"===(o=e.options[s]).getAttribute("data-origin-disabled")&&o.removeAttribute("disabled")}this.disabled_limit=!1}}"change",i=e,(l=document.createEvent("HTMLEvents")).initEvent("change",!1,!0),i.dispatchEvent(l)}},t=function(e,t){if(e.wrapper.selected.innerHTML="",e.wrapper.non_selected.innerHTML="",t.non_selected_header&&t.selected_header){var a=document.createElement("div"),n=document.createElement("div");a.className="header",n.className="header",a.innerText=t.non_selected_header,n.innerText=t.selected_header,e.wrapper.non_selected.appendChild(a),e.wrapper.selected.appendChild(n)}if(e.wrapper.search)var i=e.wrapper.search.value;for(var l=null,d=null,r=0;r<e.options.length;r++){var s=e.options[r],o=s.value,c=s.textContent||s.innerText,p=document.createElement("a");if(p.tabIndex=0,p.className="item",p.innerText=c,p.setAttribute("role","button"),p.setAttribute("data-value",o),p.setAttribute("multi-index",r),s.disabled&&(p.className+=" disabled"),s.selected){p.className+=" selected";var u=p.cloneNode(!0);e.wrapper.selected.appendChild(u)}if("OPTGROUP"==s.parentNode.nodeName&&s.parentNode!=d){if(d=s.parentNode,(l=document.createElement("div")).className="item-group",s.parentNode.label){var h=document.createElement("span");h.innerHTML=s.parentNode.label,h.className="group-label",l.appendChild(h)}e.wrapper.non_selected.appendChild(l)}s.parentNode==e&&(l=null,d=null),(!i||i&&c.toLowerCase().indexOf(i.toLowerCase())>-1)&&(null!=l?l.appendChild(p):e.wrapper.non_selected.appendChild(p))}};return function(a,n){if((n=void 0!==n?n:{}).enable_search=void 0===n.enable_search||n.enable_search,n.search_placeholder=void 0!==n.search_placeholder?n.search_placeholder:"Search...",n.non_selected_header=void 0!==n.non_selected_header?n.non_selected_header:null,n.selected_header=void 0!==n.selected_header?n.selected_header:null,n.limit=void 0!==n.limit?parseInt(n.limit):-1,isNaN(n.limit)&&(n.limit=-1),null==a.dataset.multijs&&"SELECT"==a.nodeName&&a.multiple){a.style.display="none",a.setAttribute("data-multijs",!0);var i=document.createElement("div");if(i.className="multi-wrapper",n.enable_search){var l=document.createElement("input");l.className="search-input",l.type="text",l.setAttribute("placeholder",n.search_placeholder),l.addEventListener("input",function(){t(a,n)}),i.appendChild(l),i.search=l}var d=document.createElement("div");d.className="non-selected-wrapper";var r=document.createElement("div");r.className="selected-wrapper",i.addEventListener("click",function(t){t.target.getAttribute("multi-index")&&e(a,t,n)}),i.addEventListener("keypress",function(t){var i=32===t.keyCode||13===t.keyCode;t.target.getAttribute("multi-index")&&i&&(t.preventDefault(),e(a,t,n))}),i.appendChild(d),i.appendChild(r),i.non_selected=d,i.selected=r,a.wrapper=i,a.parentNode.insertBefore(i,a.nextSibling);for(var s=0;s<a.options.length;s++){var o=a.options[s];o.setAttribute("data-origin-disabled",o.disabled)}t(a,n),a.addEventListener("change",function(){t(a,n)}),$(".multiple-select-all").click(function(){var e=$(this).data("target");$("#"+e+" option").prop("selected",!0),t(a,n)}),$(".multiple-deselect-all").click(function(){var e=$(this).data("target");$("#"+e+" option").prop("selected",!1),t(a,n)})}}}();"undefined"!=typeof jQuery&&function(e){e.fn.multi=function(t){return t=void 0!==t?t:{},this.each(function(){var a=e(this);multi(a.get(0),t)})}}(jQuery);